<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ランニングペース計算</title>

<style>
  body{
    font-family:sans-serif;
    background:#f5f5f5;
    padding:20px;
    display:flex;
    justify-content:center;
  }
  .card{
    background:#fff;
    padding:20px;
    border-radius:12px;
    max-width:520px;
    width:100%;
    box-shadow:0 2px 10px rgba(0,0,0,.1);
  }
  h1{text-align:center;margin-bottom:20px;}

  label{display:block;margin-top:15px;font-weight:600;}
  input,select{
    width:100%;padding:10px;margin-top:5px;
    border:1px solid #ccc;border-radius:6px;
  }

  .adopt{margin-top:8px;color:#006600;font-weight:700;}

  .time-wrap{display:flex;gap:8px;margin-top:5px;}

  button{
    width:100%;padding:12px;margin-top:16px;
    background:#1976d2;color:#fff;border:none;
    border-radius:6px;font-size:1rem;cursor:pointer;
  }

  #result{
    margin-top:20px;padding:15px;background:#fafafa;
    border-radius:10px;border:1px solid #ddd;display:none;
  }
  .row{display:flex;justify-content:space-between;margin-bottom:10px;}
  .label{color:#555;}
  .value{font-weight:700;}
</style>
</head>

<body>

<div class="card">
  <h1>ランニングペース計算</h1>

  <!-- 距離欄はこれ１つだけ！ -->
  <label>距離（選択＋手動入力）</label>
  <input id="distanceInput" list="distList" placeholder="例：5km, 1500m, ハーフ, マラソン, 3.6 など自由入力可">
  <datalist id="distList">
    <option value="1500m">
    <option value="3000m">
    <option value="5000m">
    <option value="10000m">
    <option value="ハーフ">
    <option value="マラソン">
    <option value="3000mSC（外）">
    <option value="3000mSC（内）">
  </datalist>

  <div id="adopted" class="adopt">採用距離：-- km</div>

  <label>完走タイム（時:分:秒）</label>
  <div class="time-wrap">
    <input id="h" type="number" min="0" placeholder="時">
    <input id="m" type="number" min="0" max="59" placeholder="分">
    <input id="s" type="number" min="0" max="59" placeholder="秒">
  </div>

  <button id="calcBtn">計算する</button>
  <button id="clearBtn" style="background:#666">クリア</button>

  <div id="result"></div>
</div>


<script>
// ------ フォーマット関数 ------
function formatTenth(sec){
  return (Math.round(sec*10)/10).toFixed(1);
}
function formatMMSS(sec){
  sec=Math.round(sec);
  return Math.floor(sec/60)+":"+String(sec%60).padStart(2,"0");
}
function formatHMS(sec){
  sec=Math.round(sec);
  return (
    Math.floor(sec/3600)+":"+
    String(Math.floor((sec%3600)/60)).padStart(2,"0")+":"+
    String(sec%60).padStart(2,"0")
  );
}
function formatAuto(sec){
  return (sec>=3600)?formatHMS(sec):formatMMSS(sec);
}


// ------ 距離解析 ------
function parseDistance(input){
  if(!input) return null;

  input=input.trim();

  // SC
  if(input.includes("SC") && input.includes("外")){
    return {km:3, type:"sc_out"};
  }
  if(input.includes("SC") && input.includes("内")){
    return {km:3, type:"sc_in"};
  }

  // ハーフ
  if(input.includes("ハーフ")){
    return {km:21.0975, type:"normal"};
  }

  // マラソン
  if(input.includes("マラソン")){
    return {km:42.195, type:"normal"};
  }

  // m表記（例：1500m）
  if(input.endsWith("m")){
    let n=parseFloat(input.replace("m",""));
    if(!isNaN(n)) return {km:n/1000, type:"normal"};
  }

  // km表記（例：5km）
  if(input.endsWith("km")){
    let n=parseFloat(input.replace("km",""));
    if(!isNaN(n)) return {km:n, type:"normal"};
  }

  // 数字だけ（ → km と判断）
  let n=parseFloat(input);
  if(!isNaN(n)) return {km:n, type:"normal"};

  return null;
}


// ------ 採用距離表示 ------
document.getElementById("distanceInput").oninput = function(){
  const d=parseDistance(this.value);
  document.getElementById("adopted").innerText =
    d?("採用距離："+d.km+" km"):"採用距離：不明";
};


// ------ 計算 ------
document.getElementById("calcBtn").onclick=function(){

  const d=parseDistance(document.getElementById("distanceInput").value);
  if(!d){ alert("距離を正しく入力してください"); return; }

  let distKm=d.km;

  const h=parseInt(document.getElementById("h").value||0);
  const m=parseInt(document.getElementById("m").value||0);
  const s=parseInt(document.getElementById("s").value||0);
  const total=h*3600+m*60+s;

  if(total<=0){ alert("時間を正しく入力してください"); return; }

  const secPerKm=total/distKm;

  const area=document.getElementById("result");
  area.innerHTML="";
  area.style.display="block";

  // --- SC mode ---
  if(d.type==="sc_out" || d.type==="sc_in"){
    const lap=(d.type==="sc_out")?421:390;

    area.innerHTML+=`
      <div class="row"><div class="label">100 m</div>
      <div class="value">${formatTenth(secPerKm/10)}</div></div>`;

    area.innerHTML+=`
      <div class="row"><div class="label">${lap} m</div>
      <div class="value">${formatTenth(secPerKm*(lap/1000))}</div></div>`;

    area.innerHTML+=`
      <div class="row"><div class="label">1 km</div>
      <div class="value">${formatMMSS(secPerKm)}</div></div>`;
  }

  // --- 通常 ---
  else{
    area.innerHTML+=`
      <div class="row"><div class="label">100 m</div>
      <div class="value">${formatTenth(secPerKm/10)}</div></div>`;

    area.innerHTML+=`
      <div class="row"><div class="label">400 m</div>
      <div class="value">${formatTenth(secPerKm*0.4)}</div></div>`;

    area.innerHTML+=`
      <div class="row"><div class="label">1 km</div>
      <div class="value">${formatMMSS(secPerKm)}</div></div>`;

    for(let km=5; km<=distKm; km+=5){
      area.innerHTML+=`
        <div class="row"><div class="label">${km} km</div>
        <div class="value">${formatAuto(secPerKm*km)}</div></div>`;
    }

    if(distKm%5!==0){
      area.innerHTML+=`
        <div class="row"><div class="label">${distKm} km（最終）</div>
        <div class="value">${formatAuto(secPerKm*distKm)}</div></div>`;
    }
  }

  area.innerHTML+=`
    <div class="row"><div class="label">合計時間</div>
    <div class="value">${formatHMS(total)}</div></div>`;
};


// ------ クリア ------
document.getElementById("clearBtn").onclick=function(){
  document.getElementById("distanceInput").value="";
  document.getElementById("h").value="";
  document.getElementById("m").value="";
  document.getElementById("s").value="";
  document.getElementById("result").style.display="none";
  document.getElementById("adopted").innerText="採用距離：-- km";
};
</script>

</body>
</html>

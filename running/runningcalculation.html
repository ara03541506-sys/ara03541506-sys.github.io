<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>ランニング計算</title>

<style>
  body{
    font-family:sans-serif;
    background:#f5f5f5;
    padding:20px;
    display:flex;
    justify-content:center;
  }
  .card{
    background:#fff;
    padding:20px;
    border-radius:12px;
    max-width:520px;
    width:100%;
    box-shadow:0 2px 10px rgba(0,0,0,.1);
  }
  h1{text-align:center;margin-bottom:20px;}

  label{font-weight:600;display:block;margin-top:15px;}

  /* 距離入力欄（スマホズーム防止） */
  .combo-box{
    width:100%;
    padding:12px;
    background:#fff;
    border:1px solid #ccc;
    border-radius:6px;
    font-size:16px;     /* ←スマホズーム防止：16px以上必須 */
  }

  /* ===== ドロップダウン（スクロール可視化） ===== */
  .dropdown{
    display:none;
    background:white;
    border:1px solid #ccc;
    border-radius:6px;
    margin-top:6px;
    max-height:200px;
    overflow-y:auto;
    position:relative;
    scrollbar-gutter: stable both-edges;
  }

  .dropdown::-webkit-scrollbar {
    width: 8px;
  }
  .dropdown::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
  }

  /* 下部フェード（スクロールできることを示す） */
  .dropdown::after{
    content:"";
    position:absolute;
    bottom:0;
    left:0;
    width:100%;
    height:30px;
    background:linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,1));
    pointer-events:none;
  }

  .scroll-hint{
    text-align:center;
    padding:4px;
    font-size:14px;
    color:#888;
  }

  .item{
    padding:12px;
    border-bottom:1px solid #eee;
  }
  .item:hover{
    background:#f0f0f0;
  }

  .manual-btn{
    width:100%;
    margin-top:6px;
    padding:12px;
    border:none;
    border-radius:6px;
    background:#1976d2;
    color:#fff;
  }

  .adopt{margin-top:8px;color:#006600;font-weight:700;}

  .time-wrap{display:flex;gap:8px;margin-top:5px;}
  input.time{
    width:100%;
    padding:12px;
    font-size:16px; /* ズーム防止 */
    border-radius:6px;
    border:1px solid #ccc;
  }

  button{
    width:100%;padding:12px;margin-top:16px;
    background:#1976d2;color:#fff;border:none;
    border-radius:6px;font-size:1rem;
  }

  #result{
    margin-top:20px;padding:15px;background:#fafafa;
    border-radius:10px;border:1px solid #ddd;display:none;
  }
  .row{display:flex;justify-content:space-between;margin-bottom:10px;}
  .label{color:#555;}
  .value{font-weight:700;}
</style>
</head>

<body>

<div class="card">
  <h1>ランニング計算</h1>

  <label>距離（選択＋手動入力）</label>

  <!-- これが一つの距離欄 -->
  <div id="distanceField" class="combo-box">タップして選択 / 入力</div>

  <!-- カスタムドロップダウン -->
  <div id="dropdown" class="dropdown">
    <div class="item" data-val="1500m">1500m</div>
    <div class="item" data-val="3000m">3000m</div>
    <div class="item" data-val="5000m">5000m</div>
    <div class="item" data-val="10000m">10000m</div>
    <div class="item" data-val="ハーフ">ハーフ</div>
    <div class="item" data-val="マラソン">マラソン</div>
    <div class="item" data-val="3000mSC（外）">3000mSC（外）</div>
    <div class="item" data-val="3000mSC（内）">3000mSC（内）</div>

  </div>

  <button class="manual-btn" onclick="manualInput()">手動入力する（m）</button>

  <div id="adopted" class="adopt">採用距離：-- km</div>



  <label>完走タイム（時:分:秒）</label>
  <div class="time-wrap">
    <input id="h" type="number" class="time" placeholder="時">
    <input id="m" type="number" class="time" placeholder="分">
    <input id="s" type="number" class="time" placeholder="秒">
  </div>

  <button onclick="calc()">計算する</button>
  <button style="background:#666" onclick="clearAll()">クリア</button>

  <div id="result"></div>
</div>

<script>
// ---------- スマホ対応コンボボックス ----------
const field=document.getElementById("distanceField");
const drop=document.getElementById("dropdown");

field.onclick=()=> drop.style.display = (drop.style.display==="block"?"none":"block");

document.querySelectorAll(".item").forEach(el=>{
  el.onclick=()=>{
    field.innerText = el.dataset.val;
    drop.style.display="none";
    updateAdopt();
  };
});

// 手動入力ボタン
function manualInput(){
  let val = prompt("距離をm単位で入力してください（例：3600）");
  if(val){
    field.innerText = val+"m";
    updateAdopt();
  }
}


// ---------- 距離解析 ----------
function parseDistance(input){
  if(!input) return null;

  input=input.trim();

  if(input.includes("外")) return {km:3, type:"sc_out"};
  if(input.includes("内")) return {km:3, type:"sc_in"};

  if(input.includes("ハーフ")) return {km:21.0975, type:"normal"};
  if(input.includes("マラソン")) return {km:42.195, type:"normal"};

  if(input.endsWith("m")){
    let n=parseFloat(input);
    return {km:n/1000, type:"normal"};
  }
  if(input.endsWith("km")){
    let n=parseFloat(input);
    return {km:n, type:"normal"};
  }

  let n=parseFloat(input);
  if(!isNaN(n)) return {km:n, type:"normal"};

  return null;
}


// ---------- 採用距離表示 ----------
function updateAdopt(){
  let d=parseDistance(field.innerText);
  document.getElementById("adopted").innerText =
    d?("採用距離："+d.km+" km"):"採用距離：不明";
}


// ---------- 時間フォーマット ----------
function fT(sec){return (Math.round(sec*10)/10).toFixed(1);}
function fMM(sec){sec=Math.round(sec);return Math.floor(sec/60)+":"+String(sec%60).padStart(2,"0");}
function fH(sec){sec=Math.round(sec);return Math.floor(sec/3600)+":"+String(Math.floor((sec%3600)/60)).padStart(2,"0")+":"+String(sec%60).padStart(2,"0");}
function fAuto(sec){return sec>=3600?fH(sec):fMM(sec);}


// ---------- 計算 ----------
function calc(){

  let d=parseDistance(field.innerText);
  if(!d){ alert("距離を正しく選択/入力してください。"); return; }

  const h=parseInt(document.getElementById("h").value||0);
  const m=parseInt(document.getElementById("m").value||0);
  const s=parseInt(document.getElementById("s").value||0);
  const total=h*3600+m*60+s;

  if(total<=0){ alert("時間を入力してください。"); return; }

  const secKm=total/d.km;

  const area=document.getElementById("result");
  area.innerHTML="";
  area.style.display="block";

  if(d.type==="sc_out" || d.type==="sc_in"){
    const lap=d.type==="sc_out"?421:390;

    area.innerHTML+=`<div class="row"><div class="label">100 m</div><div class="value">${fT(secKm/10)}</div></div>`;
    area.innerHTML+=`<div class="row"><div class="label">${lap} m</div><div class="value">${fT(secKm*(lap/1000))}</div></div>`;
    area.innerHTML+=`<div class="row"><div class="label">1 km</div><div class="value">${fMM(secKm)}</div></div>`;
  }else{
    area.innerHTML+=`<div class="row"><div class="label">100 m</div><div class="value">${fT(secKm/10)}</div></div>`;
    area.innerHTML+=`<div class="row"><div class="label">400 m</div><div class="value">${fT(secKm*0.4)}</div></div>`;
    area.innerHTML+=`<div class="row"><div class="label">1 km</div><div class="value">${fMM(secKm)}</div></div>`;

    for(let i=5;i<=d.km;i+=5){
      area.innerHTML+=`<div class="row"><div class="label">${i} km</div><div class="value">${fAuto(secKm*i)}</div></div>`;
    }
    if(d.km%5!==0){
      area.innerHTML+=`<div class="row"><div class="label">${d.km} km（最終）</div><div class="value">${fAuto(secKm*d.km)}</div></div>`;
    }
  }

  area.innerHTML+=`<div class="row"><div class="label">合計時間</div><div class="value">${fH(total)}</div></div>`;
}


// ---------- クリア ----------
function clearAll(){
  field.innerText="タップして選択 / 入力";
  document.getElementById("h").value="";
  document.getElementById("m").value="";
  document.getElementById("s").value="";
  document.getElementById("result").style.display="none";
  document.getElementById("adopted").innerText="採用距離：-- km";
}
</script>

</body>
</html>
